* 2026.01.09 19:04:45

# Техническое задание (ТЗ.md) v0.1
## Проект: pro_ai_agents — фабрика контента для Telegram-канала «Про ИИ Агентов»

**Канал:** https://t.me/pro_ai_agents  
**Репозиторий:** https://github.com/bahiyadn/pro_ai_agents  
**Дата:** 2026-01-09  
**Часовой пояс расписаний:** Europe/Moscow  
**Статус:** v0.1 (MVP-ориентированное ТЗ)

---

## 0. Нормативная и организационная база

### 0.1 Основание для разработки
Инициативный проект редакции канала. Основания: утверждённый анализ предметной области и результаты интервью (в репозитории /docs).  

### 0.2 Нормативные документы
- ГОСТ 34.602 (Техническое задание на создание АС).
- Внутренние документы проекта (см. раздел 11).

### 0.3 Стороны и роли
- **Редакция / владелец продукта:** определяет тематику, рубрики, стиль, требования к шаблонам.
- **Оператор-модератор:** 100% ручное решение по каждому материалу: Approve / Reject / Edit.
- **Система (автоматизация):** сбор материалов, подготовка кандидатов, генерация черновиков, отчётность, публикация после ручного решения.

---

## 1. Назначение и цели

### 1.1 Назначение
Автоматизировать цикл подготовки и публикации инженерно ориентированного контента по теме «агентный ИИ (agentic AI)» в Telegram.

### 1.2 Цели MVP
- Регулярная публикация: новости + статья + отчёт по расписанию.
- Строгое источниковедение: первоисточник обязателен, дедуп по канонизированному URL.
- Управляемое качество: ручная модерация 100% материалов + метрики процесса.

---

## 2. Объект автоматизации и контекст

### 2.1 Объект
Процесс редакции Telegram-канала: от обнаружения материалов до публикации и учёта.

### 2.2 Целевая аудитория (для требований к тону и структуре)
Исследователи, разработчики, аналитики; уровень junior–middle; допускаются блоки для продвинутых.

### 2.3 Тематические границы (ДА/НЕТ)
**В тематике:** агентные системы, инструменты/стек, практика/паттерны, архитектура, исследования, качество/безопасность/комплаенс, база терминов, кейсы при наличии инженерной ценности.  
**Вне тематики:** общий ML/DS без связи с агентами; «новости про ИИ» без инженерной ценности; финансы/крипто как тема (допустимо только как кейс автоматизации без советов).

---

## 3. Рубрики (утверждённый набор на MVP)
**Вариант 1 (научный, компактный):**
- Новости
- Исследования
- Архитектура
- Качество (безопасность/комплаенс как подмножество)
- База терминов

---

## 4. Контент-политика и расписание публикаций

### 4.1 Типы контента
- **Новость (News)**
- **Статья (Insight)**
- **Отчёт (Report)** — агрегирование результатов периодических действий за период.

### 4.2 Объём
- Новости: **2–6/сутки** (по мере обнаружения; минимум обеспечивается расписанием).
- Статья: **1/сутки**.
- Отчёт: **1/сутки**.

### 4.3 Расписание (плановые окна)
- **Статья:** 10:00
- **Новости:** 12:00 и 18:00 (минимум 2; дополнительные — в ближайший слот или вручную вне слота)
- **Отчёт:** 21:00

---

## 5. Требования к структуре публикаций (шаблоны)

### 5.1 template_content_tg_news
- Title (required, 3–10 слов)
- Datetime (required, datetime)
- Body (required, до ~1500 символов)
- Sources (required, 1–3; Sources[0] = первоисточник)
- Tags (required, 2–6)

### 5.2 template_content_tg_insight
- Title (required, 3–10 слов)
- Datetime (required, datetime)
- Summary (optional, 1 абзац)
- Body (required, до ~6000 символов)
- Sources (required, 1–3; Sources[0] = первоисточник)
- Tags (required, 2–6)

### 5.3 template_content_tg_report
- Title (required, 3–10 слов)
- Datetime (required, datetime)
- Period (required, datetime-datetime)
- Summary (optional, 1 абзац)
- Body (required, до ~6000 символов)
- Sources (required, 1–3; Sources[0] = первоисточник)
- Tags (required, 2–6)

---

## 6. Требования к стилю (утверждённые правила)

### 6.1 Новости и отчёты
- Тон: нейтральный инженерный.
- Обращение к читателю: отсутствует (исключение — редкие инструкции).
- Эмодзи: запрещены.
- Клише/хайп: запрещены.
- Структура: «Что произошло → Почему важно → Примеры/контекст».

### 6.2 Статьи
- Тон: исследовательский, осторожный, объясняющий.
- Обращение: допускается «вы».
- Обязательное разделение: **факт / интерпретация / гипотеза**.
- Запрет категоричных заявлений без ссылки.
- Структура: «Что произошло → Почему важно → Как проверить/повторить».

### 6.3 Терминология
- Первое упоминание: RU (EN).
- Далее: RU; EN — только отраслевой стандарт/имена технологий.

---

## 7. Источниковедение и фактчекинг

### 7.1 Уровни доверия источников
1) Спецификации/стандарты  
2) Официальная документация  
3) Официальные репозитории (releases/changelog/tags; issues/PR — как подтверждение факта)  
4) Официальные блоги/пресс-релизы  
5) Научные публикации/препринты (с пометкой статуса)

Запрещено: пересказы без первоисточника; соцсети/форумы как единственный источник; SEO/анонимные публикации без реквизитов; немаркированная реклама; «подборки» без проверяемых фактов.

### 7.2 Правило первоисточника
- В каждой публикации **обязателен** Sources[0] из уровней 1–4.
- Всего источников: 1–3.

### 7.3 Политика фактчекинга (Вариант B — баланс)
- **Низкий риск:** релиз/дата/версия/факт появления документа — достаточно Sources[0].
- **Средний риск:** числа, бенчмарки, производительность, совместимость — Sources[0] + 1 подтверждающий официальный источник (Sources[1]).
- **Высокий риск:** безопасность, комплаенс, правовые утверждения — Sources[0] + подтверждение; при отсутствии подтверждения: Reject либо маркировка «не подтверждено» (если важно для контекста и явно отделено от факта).
- Цитаты: не обязательны; добавлять только для точных чисел/сильных утверждений (1–2 предложения).

### 7.4 Базовые знания
Вводится «реестр базовых источников знаний» (книги/обзоры) для терминологии и общих тезисов. Он **не заменяет** первоисточник для новостей.

---

## 8. Дедупликация и канонизация первоисточника

### 8.1 Дедупликация
- Дубль = совпадение **канонизированного** Sources[0].
- Если Sources[0] уже опубликован или в очереди — не публиковать.
- Если в течение 24 часов есть существенные новые детали по тому же Sources[0] — обновить существующий материал (1–2 пункта + время).

### 8.2 Канонизация URL (Вариант B — строгая)
Канонизация применяется для Sources[0] и SourceItem.CanonicalUrl:
- Нормализация: scheme/host в lower; удаление fragment (#...); нормализация trailing slash.
- Удаление трекинга: utm_*, gclid, fbclid и аналоги.
- Query:
  - сортировка параметров по имени;
  - **whitelist** сохраняемых параметров (по умолчанию: `id`, `tag`); остальные удаляются.
- Результат: стабильный CanonicalUrl для дедупа.

---

## 9. Модерация и комплаенс

### 9.1 Модерация
- 100% материалов проходят ручное решение (Approve / Reject / Edit).
- SLA на MVP не фиксируется; есть очередь непроверенных материалов.
- Причины Reject (enum):
  - Duplicate
  - NoPrimarySource
  - OffTopic
  - FactRisk
  - StyleViolation
  - ComplianceRisk

### 9.2 Комплаенс (MVP = справочники + чек-лист)
- Реклама: по умолчанию запрещена; при разрешении — отдельный тип поста с обязательной маркировкой и реквизитами.
- Реестровые пометки (иноагенты и др.): при упоминании — стандартная пометка.
- Запрещённые материалы: не публиковать ссылки/цитаты из федерального списка экстремистских материалов.
- Запрещённые/экстремистские/террористические организации: только при редакционной необходимости, нейтрально, без популяризации; обязательный ручной чек.

---

## 10. Требования к системе автоматизации (функции)

### 10.1 Оркестрация (n8n)
Система реализуется как набор workflow в n8n:
- планировщик по расписанию (Cron);
- сбор материалов из источников;
- нормализация/канонизация;
- дедуп;
- подготовка кандидатов;
- генерация черновиков;
- ручная модерация (через удобный операторский контур);
- публикация в Telegram после Approve;
- ежедневный отчёт.

### 10.2 Источники (каналы на MVP)
- RSS/официальные сайты/официальные репозитории (releases/tags/changelog).
- Препринты (arXiv RSS) — с пометкой статуса.

Полный реестр источников оформляется отдельным дополнением.

---

## 11. Требования к данным и хранилищам (MVP)

### 11.1 Хранилища
- StorageDb: PostgreSQL (метаданные и состояния).
- StorageBlob: MinIO S3 (слепки/медиа), локально в Docker.

### 11.2 Сущности (минимум)
- Source: SourceId, Name, SourceType, TrustLevel(1..5), BaseUrl, IsEnabled
- SourceItem: SourceItemId, SourceId, CanonicalUrl, Title, PublishedAt, FetchedAt, RawStorageKey, RawHash, TextHash
- Candidate: CandidateId, SourceItemId, ContentType(News|Insight|Report), Status(Queued|Drafted|Rejected|Published), Score, CreatedAt
- Draft: DraftId, CandidateId, TemplateName, Title, Datetime, Body, Summary?, Period?, SourcesJson, TagsJson, LlmProvider, LlmModel, LlmCost, CreatedAt
- ModerationDecision: DecisionId, DraftId, Decision(Approve|Reject|Edit), RejectReason, DecidedBy, DecidedAt, Note?
- Publication: PublicationId, DraftId, TgChannelName, TgMessageId, PublishedAt, EditedAt?

### 11.3 Целостность (минимум)
- Unique(SourceItem.CanonicalUrl)
- Запрет повторной публикации при совпадении Sources[0] (CanonicalUrl)

---

## 12. Требования к LLM (утверждённая схема)

### 12.1 Провайдеры (Вариант B — два провайдера)
- Alibaba qwen-flash: извлечение фактов/первичный черновик.
- OpenAI gpt-4o-mini: финальная редактура (структура/стиль/ясность).
- OpenAI gpt-4.1-nano: быстрая валидация формата/чек-лист.

### 12.2 Контракты вывода (строгие JSON)
Все LLM-шаги возвращают JSON:
1) ExtractFactsJson:
   - canonical_url, title, published_at
   - facts[]: {claim, evidence_url, evidence_quote?}
   - entities[]: {name, type}
   - tags[] (2–6)
2) GenerateDraftJson:
   - template_name
   - Title, Datetime, Body, Summary?, Period?, Sources(1–3), Tags(2–6)
3) ValidateDraftJson:
   - is_valid (bool)
   - reject_reason? (enum)
   - fixes? [{field, action, value}]
4) RenderText: финальный рендер Telegram-текста из утверждённого Draft.

---

## 13. Метрики качества (MVP)

Период: последние 24 часа.
- PublishCount
- RejectRate
- RejectReasonTop (по enum)
- CycleTimeMinutes (median: published_at − candidate_created_at)
- LLMCostPerPost (управленческий показатель)

Для отчётов: метрики не требуются (возможны позже).

---

## 14. Инфраструктурные риски (локальный сервер) — Вариант A (минимум)

- Backup:
  - принимается риск потери данных до 24 часов;
  - 1 раз/сутки: dump PostgreSQL + экспорт MinIO на внешний диск.
- Updates:
  - принимается риск работы на фиксированных версиях;
  - обновления 1 раз/год вручную (Docker Desktop, n8n, Postgres, MinIO).
- Secrets:
  - принимается риск утечки при физическом/админ доступе к серверу;
  - хранение только в `.env` на сервере; не хранить в workflow; не коммитить в репозиторий.
- n8n access:
  - принимается риск «LAN = доверенная»;
  - доступ только из LAN; basic auth включён; публичного доступа нет.
- Logging:
  - принимается риск неполной диагностики;
  - docker logs + записи состояний (Candidate/Draft/Decision/Publication) + ежедневный отчёт по метрикам.

---

## 15. Этапы работ и критерии готовности (MVP)

### 15.1 Этапы
1) Инфраструктура (готово частично): Windows 10 + Docker Desktop + Node.js + n8n.
2) MVP-пайплайн: ingestion → canonicalize → dedup → candidate → draft → moderation → publish.
3) Ежедневный отчёт (Report) + метрики 24h.
4) Реестр источников + базовые знания (как дополнения).

### 15.2 Критерии готовности MVP
- Публикации по расписанию: 1 статья/сутки, 2 новости/сутки, 1 отчёт/сутки (при наличии материалов).
- Дедуп по CanonicalUrl работает (нет повторов Sources[0]).
- 100% ручная модерация функционирует.
- Хранилища Postgres+MinIO работают, есть ежедневный бэкап.
- Все LLM шаги работают строго по JSON-контрактам.

---

## 16. Порядок контроля и приёмки

- Приёмка MVP — по чек-листу критериев готовности (раздел 15.2).
- Контрольные проверки:
  - канонизация URL на тест-наборе ссылок;
  - дедуп на тест-наборе материалов;
  - валидация JSON-контрактов;
  - проверка публикации в тестовый канал/чат (до боевого).

---

## 17. Требования к документации (в репозитории)

Обязательные документы:
- `АнализПредметнойОбласти.md` (утверждён).
- `ТЗ.md` (этот файл).
- `Цели.md` (цели/миссия/позиционирование).
- `КонтентПлан.md` (темы/рубрики/периоды).
- Runbook (эксплуатация, бэкапы, обновления, секреты).

---

## 18. Реестр дополнений (будут выведены отдельными файлами)

1) `Дополнение_Источники.md` — реестр источников (trust level, URL, формат, включено/выключено).  
2) `Дополнение_Промпты.md` — системные промпты и JSON-схемы (Extract/Generate/Validate/Render).  
3) `Дополнение_МодельДанных.md` — уточнение сущностей/enum/индексов Postgres.  
4) `Дополнение_Модерация.md` — чек-листы модератора и комплаенса.  
5) `Дополнение_Отчёты.md` — состав ежедневного отчёта (Report) и формат вывода.

---
