* 2026.01.09 20:57:06

# Backlog реализации АС «pro_ai_agents» (MVP)

**Дата:** 2026-01-09  
**Основание:** ТЗ.md v0.1 и утверждённые дополнения  
**Статус:** рабочий backlog MVP

---

## Принципы ведения журнала задач

- Задачи описываются в терминах **готового результата**, а не процесса.
- Каждая задача должна:
  - иметь проверяемый outcome;
  - опираться на конкретный раздел ТЗ или дополнение.
- Декомпозиция — до уровня, достаточного для реализации в n8n / коде / SQL.

---

## Этап 0. Базовая инфраструктура (частично выполнено)

### INF-001 Подготовка окружения Docker
**Основание:** ТЗ.md §14  
**Результат:**  
- Docker Desktop запущен;
- контейнеры: n8n, PostgreSQL, MinIO доступны локально.

Статус: выполнено / проверить

---

### INF-002 Конфигурация секретов
**Основание:** ТЗ.md §14  
**Результат:**  
- все API-ключи вынесены в `.env`;
- ключи не используются напрямую в workflow;
- `.env` исключён из репозитория.

---

### INF-003 Ограничение доступа к n8n
**Основание:** ТЗ.md §14  
**Результат:**  
- n8n доступен только из LAN;
- включён basic auth;
- отсутствует публичный endpoint.

---

## Этап 1. Модель данных и хранилища

### DB-001 Проектирование схемы PostgreSQL
**Основание:** Дополнение_МодельДанных.md  
**Результат:**  
- созданы таблицы: Source, SourceItem, Candidate, Draft, ModerationDecision, Publication;
- реализованы enum и ограничения уникальности;
- индексы соответствуют дополнению.

---

### DB-002 Миграции схемы БД
**Основание:** Дополнение_МодельДанных.md  
**Результат:**  
- схема БД создаётся/обновляется через миграции;
- повторный запуск не приводит к конфликтам.

---

### DB-003 Подключение MinIO
**Основание:** ТЗ.md §11  
**Результат:**  
- настроен bucket для raw-слепков;
- SourceItem.raw_storage_key используется корректно.

---

## Этап 2. Источники и ingestion

### SRC-001 Реестр источников MVP
**Основание:** Дополнение_Источники.md  
**Результат:**  
- источники заведены в таблицу Source;
- заполнены trust_level, source_type, base_url;
- IsEnabled управляет включением.

---

### SRC-002 Ingestion из источников
**Основание:** ТЗ.md §10, Дополнение_Источники.md  
**Результат:**  
- материалы источников сохраняются как SourceItem;
- сохраняются raw-слепки и хэши;
- published_at и fetched_at корректны.

---

### SRC-003 Канонизация URL
**Основание:** ТЗ.md §8  
**Результат:**  
- реализована нормализация URL;
- удаляются tracking-параметры;
- query сортируется, применяется whitelist;
- canonical_url стабилен.

---

### SRC-004 Дедупликация SourceItem
**Основание:** ТЗ.md §8  
**Результат:**  
- при совпадении canonical_url новый SourceItem не создаётся;
- дедуп работает до генерации Candidate.

---

## Этап 3. Кандидаты и генерация черновиков

### CAND-001 Формирование Candidate
**Основание:** ТЗ.md §10, Дополнение_МодельДанных.md  
**Результат:**  
- для SourceItem создаются Candidate по ContentType;
- статус = Queued.

---

### LLM-001 Реализация ExtractFactsJson
**Основание:** Дополнение_Промпты.md  
**Результат:**  
- вызов LLM возвращает валидный JSON;
- факты не содержат интерпретаций;
- canonical_url совпадает с SourceItem.

---

### LLM-002 Реализация GenerateDraftJson
**Основание:** Дополнение_Промпты.md  
**Результат:**  
- черновики создаются строго по шаблонам;
- Sources[0] = первоисточник;
- данные сохраняются в Draft.

---

### LLM-003 Реализация ValidateDraftJson
**Основание:** Дополнение_Промпты.md  
**Результат:**  
- автоматическая валидация Draft;
- корректно выставляется is_valid и reject_reason;
- fixes применимы без изменения смысла.

---

### LLM-004 RenderText
**Основание:** Дополнение_Промпты.md  
**Результат:**  
- Draft преобразуется в финальный текст;
- отсутствует служебная информация и JSON.

---

## Этап 4. Модерация

### MOD-001 Интерфейс ручной модерации
**Основание:** Дополнение_Модерация.md  
**Результат:**  
- модератор видит Draft и источники;
- доступны решения: Approve / Edit / Reject.

---

### MOD-002 Фиксация решений модерации
**Основание:** Дополнение_МодельДанных.md, Дополнение_Модерация.md  
**Результат:**  
- создаётся ModerationDecision;
- reject_reason обязателен для Reject;
- повторное решение невозможно.

---

### MOD-003 Обработка статуса Edit
**Основание:** Дополнение_Модерация.md  
**Результат:**  
- Draft возвращается на правку;
- после правки повторно проходит модерацию.

---

## Этап 5. Публикация

### PUB-001 Публикация в Telegram
**Основание:** ТЗ.md §10  
**Результат:**  
- публикация возможна только при Approve;
- создаётся запись Publication;
- tg_message_id сохраняется.

---

### PUB-002 Защита от повторной публикации
**Основание:** ТЗ.md §8, Дополнение_МодельДанных.md  
**Результат:**  
- повторная публикация одного Draft невозможна;
- дубль по canonical_url исключён.

---

## Этап 6. Отчёты и метрики

### REP-001 Агрегация метрик за 24 часа
**Основание:** ТЗ.md §13, Дополнение_Отчёты.md  
**Результат:**  
- рассчитываются все метрики MVP;
- используются данные БД без доп. таблиц.

---

### REP-002 Генерация Daily Report
**Основание:** Дополнение_Отчёты.md  
**Результат:**  
- отчёт формируется по шаблону;
- Sources = internal://system-metrics;
- публикация в 21:00 MSK.

---

## Этап 7. Эксплуатация

### OPS-001 Ежедневный backup
**Основание:** ТЗ.md §14  
**Результат:**  
- дамп PostgreSQL;
- экспорт MinIO;
- хранение не менее 1 суток.

---

### OPS-002 Runbook
**Основание:** ТЗ.md §17  
**Результат:**  
- документ с инструкциями запуска, восстановления, обновлений.

---

## Критерий завершения MVP

Backlog MVP считается выполненным, если:
- выполняются все задачи этапов 1–6;
- публикации выходят по расписанию;
- дедуп, модерация и отчёт работают стабильно.

---
